# Project Structure

This document explains the purpose of each file in your NixOS flake project.

## Current Structure

```
nix-test/
â”œâ”€â”€ flake.nix                    # Main entry point - defines inputs & outputs
â”œâ”€â”€ flake.lock                   # Auto-generated lock file (like package-lock.json)
â”œâ”€â”€ configuration.nix            # System-wide configuration
â”œâ”€â”€ home.nix                     # User-level configuration (home-manager)
â”œâ”€â”€ hardware-configuration.nix   # Hardware-specific config (auto-generated)
â”œâ”€â”€ .gitignore                   # Git ignore file
â”œâ”€â”€ README.md                    # Main documentation
â”œâ”€â”€ COMMANDS.md                  # Quick reference for common commands
â”œâ”€â”€ MIGRATION_GUIDE.md           # BlueBuild to NixOS translation
â””â”€â”€ LEARNING_PATH.md             # Structured learning guide
```

## Recommended Expanded Structure

As your configuration grows, consider this organization:

```
nix-test/
â”œâ”€â”€ flake.nix                    # Main flake definition
â”œâ”€â”€ flake.lock                   # Locked dependencies
â”‚
â”œâ”€â”€ hosts/                       # Per-machine configurations
â”‚   â”œâ”€â”€ vex-htpc/               # Your HTPC machine
â”‚   â”‚   â”œâ”€â”€ configuration.nix   # Machine-specific system config
â”‚   â”‚   â””â”€â”€ hardware-configuration.nix
â”‚   â”œâ”€â”€ desktop/                # Another machine (optional)
â”‚   â””â”€â”€ laptop/                 # Another machine (optional)
â”‚
â”œâ”€â”€ modules/                     # Reusable NixOS modules
â”‚   â”œâ”€â”€ gnome.nix               # GNOME configuration module
â”‚   â”œâ”€â”€ gaming.nix              # Gaming setup module
â”‚   â””â”€â”€ development.nix         # Dev tools module
â”‚
â”œâ”€â”€ home/                        # Home-manager configurations
â”‚   â”œâ”€â”€ vex/                    # Your user
â”‚   â”‚   â”œâ”€â”€ home.nix            # Main home config
â”‚   â”‚   â”œâ”€â”€ gnome.nix           # GNOME settings
â”‚   â”‚   â”œâ”€â”€ shell.nix           # Shell configuration
â”‚   â”‚   â””â”€â”€ programs.nix        # Program-specific configs
â”‚   â””â”€â”€ shared/                 # Shared across users
â”‚       â””â”€â”€ default.nix
â”‚
â”œâ”€â”€ packages/                    # Custom packages
â”‚   â”œâ”€â”€ my-script/
â”‚   â”‚   â””â”€â”€ default.nix
â”‚   â””â”€â”€ custom-app/
â”‚       â””â”€â”€ default.nix
â”‚
â”œâ”€â”€ overlays/                    # Nixpkgs overlays
â”‚   â””â”€â”€ default.nix
â”‚
â”œâ”€â”€ assets/                      # Static files
â”‚   â”œâ”€â”€ wallpapers/
â”‚   â”‚   â”œâ”€â”€ light.jpg
â”‚   â”‚   â””â”€â”€ dark.jpg
â”‚   â”œâ”€â”€ icons/
â”‚   â””â”€â”€ themes/
â”‚
â””â”€â”€ docs/                        # Documentation
    â”œâ”€â”€ README.md
    â”œâ”€â”€ COMMANDS.md
    â”œâ”€â”€ MIGRATION_GUIDE.md
    â””â”€â”€ LEARNING_PATH.md
```

## File Descriptions

### Core Files

#### `flake.nix`
**Purpose**: Entry point of your flake  
**Contains**:
- Input declarations (dependencies)
- Output definitions (what the flake produces)
- References to other configuration files

**When to edit**: 
- Adding new dependencies (inputs)
- Creating new machine configs
- Adding packages or dev shells

#### `flake.lock`
**Purpose**: Locks exact versions of all inputs  
**Auto-generated**: Yes, by `nix flake update`  
**Commit to Git**: Yes! This ensures reproducibility

**When to update**: 
```bash
nix flake update  # Update all inputs
nix flake lock --update-input nixpkgs  # Update specific input
```

#### `configuration.nix`
**Purpose**: System-wide configuration  
**Contains**:
- Installed system packages
- Enabled services
- System settings
- Boot configuration
- Network settings

**Scope**: Affects all users on the system  
**Requires**: `sudo nixos-rebuild` to apply

#### `home.nix`
**Purpose**: User-level configuration  
**Contains**:
- User packages
- Dotfiles
- Application configurations
- GNOME/dconf settings
- Shell configuration

**Scope**: Affects only the specified user  
**Can be applied**: With or without sudo (depends on setup)

#### `hardware-configuration.nix`
**Purpose**: Hardware-specific configuration  
**Generated by**: `nixos-generate-config`  
**Contains**:
- Filesystem mounts
- Kernel modules
- CPU microcode
- Boot device info

**When to regenerate**: 
- After hardware changes
- New installations
- Different machines

**Note**: Usually don't commit to shared configs (machine-specific)

## Module Organization Patterns

### Pattern 1: Monolithic (Current - Simple)
```
flake.nix â†’ configuration.nix â†’ All system config
          â†’ home.nix â†’ All user config
```
**Pros**: Simple, everything in one place  
**Cons**: Gets unwieldy as config grows

### Pattern 2: Modular (Recommended for Growth)
```
flake.nix â†’ hosts/machine/configuration.nix
              â”œâ”€ imports modules/gnome.nix
              â”œâ”€ imports modules/gaming.nix
              â””â”€ imports modules/common.nix
          â†’ home/user/home.nix
              â”œâ”€ imports home/user/programs.nix
              â””â”€ imports home/user/shell.nix
```
**Pros**: Organized, reusable, maintainable  
**Cons**: More files to manage

### Pattern 3: Feature-based
```
flake.nix â†’ hosts/machine/configuration.nix
              â””â”€ imports features/
                    â”œâ”€ desktop.nix (includes GNOME)
                    â”œâ”€ multimedia.nix (media apps)
                    â”œâ”€ networking.nix
                    â””â”€ security.nix
```
**Pros**: Features can be toggled easily  
**Cons**: Requires planning

## Example: Modular Restructure

Here's how to restructure your current setup:

### 1. Create `modules/gnome.nix`
```nix
{ config, pkgs, ... }:
{
  services.xserver = {
    enable = true;
    displayManager.gdm.enable = true;
    desktopManager.gnome.enable = true;
  };
  
  environment.gnome.excludePackages = with pkgs; [
    gnome-photos
    gnome-tour
  ];
  
  environment.systemPackages = with pkgs; [
    gnomeExtensions.dash-to-dock
    gnomeExtensions.alphabetical-app-grid
  ];
}
```

### 2. Update `configuration.nix`
```nix
{ config, pkgs, ... }:
{
  imports = [
    ./hardware-configuration.nix
    ./modules/gnome.nix  # Import the module
  ];
  
  # Rest of config...
}
```

### 3. Create `home/vex/gnome.nix`
```nix
{ config, pkgs, ... }:
{
  dconf.settings = {
    "org/gnome/desktop/interface" = {
      color-scheme = "prefer-dark";
      # ...
    };
  };
}
```

### 4. Update `home.nix`
```nix
{ config, pkgs, ... }:
{
  imports = [
    ./home/vex/gnome.nix
  ];
  
  # Rest of config...
}
```

## Asset Management

### Wallpapers
```
assets/wallpapers/
â”œâ”€â”€ light.jxl
â””â”€â”€ dark.jxl

# In home.nix:
home.file.".local/share/backgrounds/vex" = {
  source = ./assets/wallpapers;
  recursive = true;
};
```

### Custom Icons/Themes
```
assets/icons/
â””â”€â”€ vex/
    â””â”€â”€ ...icon files...

# In configuration.nix or home.nix:
home.file.".local/share/icons/vex" = {
  source = ./assets/icons/vex;
  recursive = true;
};
```

## Git Structure

### What to Commit
- âœ… `flake.nix`
- âœ… `flake.lock`
- âœ… `configuration.nix`
- âœ… `home.nix`
- âœ… All modules
- âœ… Asset files (wallpapers, icons)
- âœ… Documentation

### What NOT to Commit
- âŒ `result` symlinks (from nix build)
- âŒ `hardware-configuration.nix` (if shared across machines)
- âš ï¸  Secrets (use sops-nix or similar)

### `.gitignore` should include:
```gitignore
result
result-*
*.qcow2
```

## Workflow Examples

### Adding a New Machine
1. Create `hosts/new-machine/`
2. Add `configuration.nix` and `hardware-configuration.nix`
3. Update `flake.nix`:
   ```nix
   nixosConfigurations.new-machine = nixpkgs.lib.nixosSystem {
     # ...
   };
   ```

### Sharing Config Across Machines
1. Create `modules/common.nix` with shared config
2. Import in each machine:
   ```nix
   imports = [ ../../modules/common.nix ];
   ```

### Per-User Configs
1. Create `home/username/home.nix`
2. Reference in `flake.nix`:
   ```nix
   home-manager.users.username = import ./home/username/home.nix;
   ```

## Quick Navigation

- **System packages?** â†’ `configuration.nix`
- **User packages?** â†’ `home.nix`
- **GNOME settings?** â†’ `home.nix` (dconf)
- **Services?** â†’ `configuration.nix`
- **Dotfiles?** â†’ `home.nix` (home.file)
- **Dependencies?** â†’ `flake.nix` (inputs)
- **Custom packages?** â†’ `packages/` or overlays

## Next Steps

1. âœ… Start with current simple structure
2. ğŸ“š As you learn, gradually modularize
3. ğŸ”„ Refactor when files get large (>200 lines)
4. ğŸ“ Organize by concern (system vs user vs machine)
5. ğŸš€ Share common configs across machines

Remember: Start simple, grow organically! ğŸŒ±
